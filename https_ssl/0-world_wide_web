#!/usr/bin/env bash
# shellcheck disable=SC2086

# Check for at least one parameter (domain)
if [ $# -lt 1 ]; then
  echo "Usage: $0 domain [subdomain]"
  exit 1
fi

domain="$1"
subdomain="$2"

# Bash function to display the DNS record info for a given subdomain
display_info() {
    local sub="$1"
    local fqdn="${sub}.${domain}"
    # Retrieve the DNS record information using dig and extract the record type and IP with awk.
    # The output from dig is parsed from the ANSWER SECTION.
    record_line=$(dig $fqdn | grep -A1 'ANSWER SECTION:' | tail -n1)
    record_type=$(echo $record_line | awk '{print $4}')
    destination=$(echo $record_line | awk '{print $5}')
    echo "The subdomain ${sub} is a ${record_type} record and points to ${destination}"
}

# If only domain is provided, check for the four subdomains in a specific order.
if [ -z "$subdomain" ]; then
  for sub in www lb-01 web-01 web-02; do
    display_info $sub
  done
else
  display_info $subdomain
fi
